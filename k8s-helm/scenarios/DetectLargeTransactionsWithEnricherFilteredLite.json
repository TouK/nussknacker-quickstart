{
  "metaData": {
    "id": "DetectLargeTransactions",
    "typeSpecificData": {
      "parallelism": 2,
      "spillStateToDisk": true,
      "useAsyncInterpretation": null,
      "checkpointIntervalInSeconds": null,
      "type": "StreamMetaData"
    },
    "isSubprocess": false,
    "additionalFields": {
      "description": null,
      "groups": [],
      "properties": {}
    },
    "subprocessVersions": {}
  },
  "exceptionHandlerRef": {
    "parameters": []
  },
  "nodes": [
    {
      "id": "bank-transactions",
      "ref": {
        "typ": "kafka",
        "parameters": [
          {
            "name": "Topic",
            "expression": {
              "language": "spel",
              "expression": "'transactions'"
            }
          },
          {
            "name": "Schema version",
            "expression": {
              "language": "spel",
              "expression": "'latest'"
            }
          }
        ]
      },
      "additionalFields": {
        "description": null,
        "layoutData": {
          "x": 180,
          "y": 0
        }
      },
      "type": "Source"
    },
    {
      "nextFalse": [],
      "id": "only large ones",
      "expression": {
        "language": "spel",
        "expression": "#input.amount > 20"
      },
      "isDisabled": null,
      "additionalFields": {
        "description": null,
        "layoutData": {
          "x": 360,
          "y": 360
        }
      },
      "type": "Filter"
    },
    {
      "id": "customer data",
      "service": {
        "id": "getCustomer",
        "parameters": [
          {
            "name": "customer_id",
            "expression": {
              "language": "spel",
              "expression": "#input.clientId"
            }
          }
        ]
      },
      "output": "customerData",
      "additionalFields": {
        "description": null,
        "layoutData": {
          "x": 360,
          "y": 540
        }
      },
      "type": "Enricher"
    },
    {
      "nextFalse": [],
      "id": "customer exists?",
      "expression": {
        "language": "spel",
        "expression": "#customerData != null"
      },
      "isDisabled": null,
      "additionalFields": {
        "description": null,
        "layoutData": {
          "x": 360,
          "y": 720
        }
      },
      "type": "Filter"
    },
    {
      "defaultNext": [
        {
          "id": "send for audit",
          "ref": {
            "typ": "kafka",
            "parameters": [
              {
                "name": "Topic",
                "expression": {
                  "language": "spel",
                  "expression": "'processedEvents'"
                }
              },
              {
                "name": "Schema version",
                "expression": {
                  "language": "spel",
                  "expression": "'latest'"
                }
              },
              {
                "name": "Key",
                "expression": {
                  "language": "spel",
                  "expression": ""
                }
              },
              {
                "name" : "Raw editor",
                "expression" : {
                  "language" : "spel",
                  "expression" : "true"
                }
              },
              {
                "name" : "Value validation mode",
                "expression" : {
                  "language" : "spel",
                  "expression" : "'strict'"
                }
              },
              {
                "name": "Value",
                "expression": {
                  "language": "spel",
                  "expression": "#input"
                }
              }
            ]
          },
          "endResult": null,
          "isDisabled": null,
          "additionalFields": {
            "description": null,
            "layoutData": {
              "x": 540,
              "y": 1080
            }
          },
          "type": "Sink"
        }
      ],
      "nexts": [
        {
          "expression": {
            "language": "spel",
            "expression": "#category == \"STANDARD\""
          },
          "nodes": [
            {
              "id": "alert large transaction",
              "ref": {
                "typ": "kafka",
                "parameters": [
                  {
                    "name": "Topic",
                    "expression": {
                      "language": "spel",
                      "expression": "'alerts'"
                    }
                  },
                  {
                    "name": "Schema version",
                    "expression": {
                      "language": "spel",
                      "expression": "'latest'"
                    }
                  },
                  {
                    "name": "Key",
                    "expression": {
                      "language": "spel",
                      "expression": ""
                    }
                  },
                  {
                    "name": "message",
                    "expression": {
                      "language": "spel",
                      "expression": "'Client: ' + #input.clientId + ' has exceeded limit for single transaction, value: ' + #input.amount"
                    }
                  }
                ]
              },
              "endResult": null,
              "isDisabled": null,
              "additionalFields": {
                "description": null,
                "layoutData": {
                  "x": 180,
                  "y": 1080
                }
              },
              "type": "Sink"
            }
          ]
        }
      ],
      "id": "category",
      "expression": {
        "language": "spel",
        "expression": "#customerData.category"
      },
      "exprVal": "category",
      "additionalFields": {
        "description": null,
        "layoutData": {
          "x": 360,
          "y": 900
        }
      },
      "type": "Switch"
    }
  ],
  "additionalBranches": []
}